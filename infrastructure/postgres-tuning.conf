# PostgreSQL Performance Tuning Configuration
# These settings are optimized for a database server with 4GB RAM
# Adjust based on your server's available memory

# ============================================================================
# MEMORY SETTINGS
# ============================================================================

# shared_buffers: Amount of memory PostgreSQL uses for caching data
# Recommended: 25% of total RAM, but not more than 8GB on 64-bit systems
# For 4GB RAM: 1GB
shared_buffers = 1GB

# effective_cache_size: Estimate of how much memory is available for caching
# Recommended: 75% of total RAM
# For 4GB RAM: 3GB
effective_cache_size = 3GB

# work_mem: Memory used for internal sort operations and hash tables
# Recommended: 64MB for complex queries, less for simple ones
# For 4GB RAM with moderate concurrency: 16MB
work_mem = 16MB

# maintenance_work_mem: Memory used for maintenance operations (VACUUM, CREATE INDEX, etc.)
# Recommended: 5% of total RAM
# For 4GB RAM: 200MB
maintenance_work_mem = 256MB

# wal_buffers: Memory used for WAL (write_to_file-Ahead Log) buffering
# Recommended: 16MB to 64MB for most systems
wal_buffers = 64MB

# max_wal_size: Maximum size of WAL files before checkpoint
# For systems with more disk space: 2GB
max_wal_size = 2GB

# min_wal_size: Minimum size of WAL files retained
min_wal_size = 512MB

# ============================================================================
# CONNECTION SETTINGS
# ============================================================================

# max_connections: Maximum number of concurrent connections
# Recommended: 200 for most applications
max_connections = 200

# superuser_reserved_connections: Reserved for superusers
superuser_reserved_connections = 5

# tcp_keepalives_idle: Time of inactivity before sending keepalive
tcp_keepalives_idle = 60

# tcp_keepalives_interval: Interval between keepalive probes
tcp_keepalives_interval = 10

# tcp_keepalives_count: Number of keepalive probes before considering connection dead
tcp_keepalives_count = 5

# ============================================================================
# QUERY OPTIMIZATION
# ============================================================================

# random_page_cost: Cost of non-sequentially fetching a disk page
# For SSD storage: 1.1
# For HDD storage: 4.0
random_page_cost = 1.1

# effective_io_concurrency: Number of simultaneous I/O operations
# For SSD storage: 200
# For HDD storage: 1
effective_io_concurrency = 200

# default_statistics_target: Default statistics target for columns
# Higher values = more accurate statistics, slower planning
default_statistics_target = 100

# constraint_exclusion: Enable constraint exclusion for query optimization
constraint_exclusion = on

# ============================================================================
# WRITE AHEAD LOG (WAL) SETTINGS
# ============================================================================

# wal_level: What information is written to WAL
# Options: minimal, replica, logical
# For replication: replica
wal_level = replica

# wal_compression: Compress WAL records
wal_compression = on

# full_page_writes: Write full pages on checkpoint
full_page_writes = on

# wal_buffers: Already configured above (64MB)

# checkpoint_completion_target: Spreads checkpoint over this fraction of checkpoint interval
checkpoint_completion_target = 0.9

# checkpoint_timeout: Time between automatic WAL checkpoints
checkpoint_timeout = 15min

# max_wal_size: Already configured above (2GB)
# min_wal_size: Already configured above (512MB)

# ============================================================================
# AUTOVACUUM SETTINGS
# ============================================================================

# autovacuum: Enable automatic vacuuming
autovacuum = on

# autovacuum_naptime: Time to sleep between vacuum runs
autovacuum_naptime = 30s

# autovacuum_vacuum_scale_factor: Fraction of table size before vacuum
autovacuum_vacuum_scale_factor = 0.05

# autovacuum_analyze_scale_factor: Fraction of table size before analyze
autovacuum_analyze_scale_factor = 0.025

# autovacuum_max_workers: Number of autovacuum workers
autovacuum_max_workers = 4

# autovacuum_vacuum_cost_delay: Cost delay for autovacuum
autovacuum_vacuum_cost_delay = 5ms

# autovacuum_vacuum_cost_limit: Cost limit for autovacuum
autovacuum_vacuum_cost_limit = 500

# ============================================================================
# LOGGING SETTINGS
# ============================================================================

# log_destination: Where to log
log_destination = 'csvlog'

# logging_collector: Enable CSV logging
logging_collector = on

# log_directory: Directory for log files
log_directory = 'log'

# log_filename: Log file naming pattern
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'

# log_rotation_age: Time between log rotation
log_rotation_age = 1d

# log_rotation_size: Size before log rotation
log_rotation_size = 100MB

# log_min_duration_statement: Log queries taking longer than this (in ms)
# 0 = all queries, -1 = disabled
log_min_duration_statement = 1000

# log_line_prefix: Format of log line prefix
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d '

# log_lock_waits: Log when waiting for lock longer than deadlock_timeout
log_lock_waits = on

# log_temp_files: Log temporary files larger than this (in kB)
log_temp_files = 0

# log_checkpoints: Log checkpoint activity
log_checkpoints = on

# log_connections: Log connection attempts
log_connections = off

# log_disconnections: Log disconnections
log_disconnections = off

# log_duration: Log query duration
log_duration = off

# log_statement: Log statements
log_statement = 'none'

# log_replication_commands: Log replication commands
log_replication_commands = off

# ============================================================================
# ERROR REPORTING
# ============================================================================

# client_min_messages: Minimum message level sent to client
client_min_messages = NOTICE

# log_error_verbosity: How much detail in error messages
log_error_verbosity = DEFAULT

# ============================================================================
# CLIENT CONNECTION DEFAULTS
# ============================================================================

# datestyle: Date/time display format
datestyle = 'iso, mdy'

# timezone: Server timezone
timezone = 'UTC'

# default_text_search_config: Default text search configuration
default_text_search_config = 'pg_catalog.english'

# ============================================================================
# LOCK MANAGEMENT
# ============================================================================

# deadlock_timeout: Time to wait before checking for deadlock
deadlock_timeout = 1s

# max_locks_per_transaction: Number of locks per transaction
max_locks_per_transaction = 256

# max_pred_locks_per_transaction: Number of predicate locks per transaction
max_pred_locks_per_transaction = 256

# ============================================================================
# PARALLEL QUERY SETTINGS
# ============================================================================

# max_parallel_workers_per_gather: Parallel workers per gather node
max_parallel_workers_per_gather = 2

# max_parallel_workers: Total number of parallel workers
max_parallel_workers = 4

# parallel_tuple_cost: Cost of moving a tuple between parallel workers
parallel_tuple_cost = 0.1

# parallel_setup_cost: Cost of setting up parallel query
parallel_setup_cost = 1000

# ============================================================================
# SSL SETTINGS (for production)
# ============================================================================

# ssl: Enable SSL
ssl = on

# ssl_cert_file: SSL certificate file
ssl_cert_file = '/certs/server.crt'

# ssl_key_file: SSL private key file
ssl_key_file = '/certs/server.key'

# ssl_ca_file: SSL certificate authority file
ssl_ca_file = '/certs/root.crt'

# ssl_crl_file: SSL certificate revocation list
# ssl_crl_file = '/certs/crl.pem'

# ssl_prefer_server_ciphers: Prefer server cipher order
ssl_prefer_server_ciphers = on

# ssl_ecdh_curve: ECDH curve for SSL
ssl_ecdh_curve = 'prime256v1'

# ssl_min_protocol_version: Minimum SSL protocol version
ssl_min_protocol_version = 'TLSv1.2'

# ssl_max_protocol_version: Maximum SSL protocol version
ssl_max_protocol_version = 'TLSv1.3'
